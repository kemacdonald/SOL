% model_lda.tex
%
% Copyright (C) 2010,2011 Laura Dietz
% Copyright (C) 2012 Jaakko Luttinen
%
% This file may be distributed and/or modified
%
% 1. under the LaTeX Project Public License and/or
% 2. under the GNU General Public License.
%
% See the files LICENSE_LPPL and LICENSE_GPL for more details.

% Latent Diriclet allocation model

%\beginpgfgraphicnamed{model-lda}

\begin{tikzpicture}[x=1.7cm,y=1.8cm]

% Box around BLR
% \draw[red, line width=0.5mm, dashed,] (-1.5,-0.25) -- (1.5,-0.25) -- (1.5, 2.25) -- (-1.5, 2.25) -- cycle;
 % Nodes
\node[obs] (y) {$y_i$}; 
\node[latent, above=	0.5 of y]   (mu)   {$\mu_i$};
\node[latent, right=	0.3 of mu]   (sigma)   {$\sigma_i$};
\node[obs, above=0.5 of mu]   (x)   {$x_i$};
\node[latent, above=	0.3 of x]   (z)   {$z_i$};


\node[latent, left=0.7 of x]   (alpha_g)   {$\alpha_i^G$};
\node[latent, left=0.2 of x]   (beta_g)   {$\beta_i^G$};
\node[latent, right=0.7 of x]   (alpha_k)   {$\alpha_i^K$};
\node[latent, right=0.2 of x]   (beta_k)   {$\beta_i^K$};


\node[latent, left=0.3 of alpha_g]   (theta)   {$\theta_i$};
\node[obs, left=1.4 of y]   (n)   {$n_i$};
\node[obs, above=0.5 of n]   (k)   {$k_i$};
\node[latent, above left=0.5 of theta]   (phi)   {$\phi$};
\node[obs, below left=0.5 of theta]   (psi)   {$\psi$};

\node[right=2 of mu] {
 $\begin{aligned}
     &\alpha \sim \text{Gaussian(0, $10$)}\\
     &\beta \sim \text{TruncatedGaussian$_-$(0, 1)}\\
     &\sigma_i \sim \text{Uniform($1/1000$, 1000)}\\
     &z_i \sim\ \text{Bernoulli(0.5)}\\
     &\phi \sim\ \text{Uniform(0.5, 1)}\\
     &\psi \leftarrow\ \text{0.5}\\
     &\theta_i \leftarrow\ 
        	\begin{cases}
    		\phi & \text{if } z_i \text{ = 1}\\
    		\psi & \text{if } z_i \text{ = 0}\\
 	 \end{cases}\\
     &k_i \sim\ \text{Binomial($\theta_i$, $n_i$)}\\
     &\mu_i \leftarrow\ 
        	\begin{cases}
    		\alpha_i^K + \beta_i^K \ast x_i & \text{if } z_i \text{ = 1}\\
    		\alpha_i^G + \beta_i^G \ast x_i & \text{if } z_i \text{ = 0}\\
 	 \end{cases}\\
     &y_i \sim\ \text{Gaussian($\mu_i$, $\sigma_i$)}
  \end{aligned}$
};


% Connect nodes
  \edge[->] {mu, sigma} {y};
  \edge[->] {x, alpha_g, beta_g, alpha_k, beta_k} {mu} ;
  \path (z) edge [bend left, ->] (mu);
   \path (z) edge [bend right, ->] (theta);
  \edge[->] {x} {beta_g} ;
  \edge[->] {x} {beta_k} ;
   \edge[->] {theta, n} {k} ;
      \edge[->] {phi, psi} {theta} ;
 
   % Plates
  \plate {} {
        (x)(mu)(y)(alpha_g)(alpha_k)(z)(theta)
  } {$i\ participants$};

\end{tikzpicture}
%\endpgfgraphicnamed

%%% Local Variables: 
%%% mode: tex-pdf
%%% TeX-master: "example"
%%% End: 
