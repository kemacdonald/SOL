---
title: "Sol-Gating Analysis"
author: "Kyle MacDonald"
date: "April 27, 2015"
output: html_document
---

This script analyzes data for sol-gating experiment. The goal 
of this analysisis to find the precise gate when participants 
can reliably identify the sign for each sign used in the SOL 
stimulus set.

Load libraries.

```{r, echo=F, warning=F, message=FALSE}
rm(list=ls())
source("../helpers/useful.R")
```

Read in data.

```{r}
df <- read.csv("sol_gating_processed-df.csv")
```

### Descriptives

```{r}
df %>%
    group_by(id) %>%
    mutate(num_trials = max(trial)) %>%
    select(id, gender, age, asl_fluency, age_learned_asl, num_trials) %>%
    distinct()
```

Histogram of main outcome variable --> Correct on 2-AFC measure

```{r}
qplot(x=correct, data=df)
```

Histogram rt just to make sure nothing weird is going on 

```{r}
qplot(x=rt, data=df)
```

## Flag and filter bad RTs

```{r}
df <- df %>%
    mutate(include_good_rt = ifelse(log(rt) > mean(log(rt)) + 2 * sd(log(rt)) |
                                        log(rt) < mean(log(rt)) - 2 * sd(log(rt)),
                                    "exclude", "include"))

df %>% group_by(include_good_rt) %>% summarise(n())

df <- filter(df, include_good_rt == "include")
```

### Main analysis

Plot accuracy for each gate within each sign.

```{r}
ms <- df %>%
    na.omit() %>% 
    group_by(gate_name, gate_num, gate_signer) %>%
    summarise(mean_correct = mean(correct),
              ci_h = ci.high(correct),
              ci_l = ci.low(correct))
```

Now plot

```{r, fig.height=12, fig.width=10}
qplot(x=gate_num, y=mean_correct, color = gate_signer, data=ms) +
    facet_wrap( ~ gate_name,ncol=8) +
    geom_line() +
    geom_pointrange(aes(ymin=mean_correct - ci_l, 
                        ymax=mean_correct + ci_h), 
                    width = .05, size=0.6) +
    theme_bw()
```