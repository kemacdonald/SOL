---
title: "SOL-analysis"
author: "Kyle MacDonald"
date: "June 9, 2015"
output: html_document
---

# Plotting, and analysis script 

```{r chunk_options}
rm(list=ls())
knitr::opts_chunk$set(warning=FALSE, message=FALSE, sanitize = T, 
                      fig.height=8, fig.width=10, echo=F, cache = T)
source("../helpers/libraries_v_3.6.R")
source("../helpers/useful.R")
library(magrittr)
library(stringr)
library(GGally)
library(kmr)
library(dplyr)
library(tidyr)
```

## Read in data

```{r}
# summary data
ss <- read.csv("sol_ss_all.csv", stringsAsFactors = F)
ss_kids <- filter(ss, age_group != "Adults")
ss_rt <- filter(ss, age_group != "Adults", exclude_chance_shifter == "include")

# tanenhaus graph values
gv_all <- read.csv("sol_gvals_all.csv", stringsAsFactors = F)
gv_coda <- read.csv("sol_gvals_coda.csv", stringsAsFactors = F)
```

## Plots

### Summary bar plots

Get the mean proportion looking to each location for each age group.

```{r}
ms_all <- ss %>% 
    group_by(age_group, value_cat) %>% 
    dplyr::summarise(mean_group_prop_looking_signer = mean(prop_looking),
              ci_low_signer = ci.low(prop_looking),
              ci_high_signer = ci.high(prop_looking))

ms_all <- ss %>% 
    filter(exclude_chance_shifter == "include") %>%
    group_by(age_group) %>% 
    dplyr::summarise(m_rt = mean(mean_correct_rt),
              ci.h_rt = ci.high(mean_correct_rt),
              ci.l_rt = ci.low(mean_correct_rt)) %>% 
    left_join(x = ms_all, by = "age_group")

all_acc <- ggplot(aes(x = age_group, y = mean_group_prop_looking_signer, fill = value_cat), 
                  data = filter(ms_all, value_cat %in% c("Target", "Distractor"))) +
    geom_bar(stat = "identity", position="dodge") +
    geom_linerange(aes(ymin = mean_group_prop_looking_signer - ci_low_signer,
                       ymax = mean_group_prop_looking_signer + ci_high_signer),
                   position = position_dodge(width = 0.9)) +
    xlab("Age Group") +
    ylab("Proportion Looking") +
    scale_fill_brewer(type = "qual", palette = "Set1") +
    guides(fill=guide_legend(title=NULL)) +
    scale_x_discrete(labels=c("Younger", "Older", "Adults")) +
    theme(plot.title = element_text(face = "bold", size = 20),
          axis.title.x = element_text(colour="grey40",size=18,
                                      angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.title.y = element_text(colour="grey40",size=18,
                                      angle=90,hjust=0.5,vjust=0.5,face="plain"),
          axis.text.x = element_text(colour="grey20",size=18,
                                     angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.text.y = element_text(colour="grey20",size=18,
                                     angle=0,hjust=0.5,vjust=0,face="plain"),
          plot.margin = unit(c(0.5,2,1,1), "cm"),
          legend.position = c(0.2, 0.8),
          legend.text = element_text(size = 16)) +
    ggtitle("Accuracy") 

all_rt <- ggplot(aes(x= age_group, y = m_rt, fill = age_group), 
                 data = filter(ms_all, value_cat == "Target")) +
    geom_bar(stat = "identity") +
    geom_linerange(aes(ymax = m_rt + ci.h_rt, ymin = m_rt - ci.l_rt)) +
    scale_fill_brewer(type = "qual", palette = "Set1") +
    guides(fill=F) +
    xlab("Age Group") +
    ylab("Mean RT (ms)") +
    ggtitle("Reaction Time") +
    scale_x_discrete(labels=c("Younger", "Older", "Adults")) +
    theme(plot.title = element_text(face = "bold", size = 20),
          axis.title.x = element_text(colour="grey40",size=18,
                                      angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.title.y = element_text(colour="grey40",size=18,
                                      angle=90,hjust=0.5,vjust=0.5,face="plain"),
          axis.text.x = element_text(colour="grey20",size=18,
                                     angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.text.y = element_text(colour="grey20",size=18,
                                     angle=0,hjust=0.5,vjust=0,face="plain"),
          plot.margin = unit(c(0.5,2,1,1), "cm"))

gridExtra::grid.arrange(all_acc, all_rt, ncol = 2)
```

Get the mean proportion looking to each location for CODA/Deaf

```{r}
ms_coda_deaf <- ss_kids %>% 
    group_by(hearing_status_participant) %>% 
    dplyr::summarise(m_age = mean(age_peek_months),
              sd_age = sd(age_peek_months),
              m_fs = mean(C_T_prop),
              ci.h_ct = ci.high(C_T_prop),
              ci.l_ct = ci.low(C_T_prop),
              m_acc = mean(target_looking_signer),
              ci.h_acc = ci.high(target_looking_signer),
              ci.l_acc = ci.low(target_looking_signer),
              m_rt = mean(mean_correct_rt),
              ci.h_rt = ci.high(mean_correct_rt),
              ci.l_rt = ci.low(mean_correct_rt))
```

### Tanenhaus plot: all participants

```{r tanenhaus-plot}
breaks <- seq(0,4000, by=500)
y_breaks <- seq(0.25,1.0, by = 0.25)
points <- seq(0,4000, by = 200)

ggplot(aes(x = to.n(Time.ms), y = mean_prop_looking, color = value_cat), 
       data = gv_all) + 
    ylim(0,1) +
    geom_rect(aes(xmin = 600, xmax = 2500, ymin = -Inf, ymax = Inf), alpha = 0.1, fill = "grey90", color = NA) +
    geom_line(data = filter(gv_all, to.n(Time.ms) %in% points), size=0.7) +
    geom_linerange(data = filter(gv_all, Time.ms %in% points),
                   aes(ymin=mean_prop_looking - ci_low, 
                       ymax=mean_prop_looking + ci_high), alpha = 0.5) +
    geom_point(data = filter(gv_all, to.n(Time.ms) %in% points), size=4) +
    xlim(0,4000) +
    geom_hline(yintercept = 0.33, linetype = "dashed") +
    facet_grid(. ~ age_group) +
    scale_color_brewer(palette = "Set1", type = "qual") +
    xlab("Time in ms from onset of noun") +
    ylab("Proportion looking") +
    guides(color = F) +
    theme_bw() +
    theme(axis.title.x = element_text(colour="grey40",size=22,
                                      angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.title.y = element_text(colour="grey40",size=22,
                                      angle=90,hjust=0.5,vjust=0.5,face="plain"),
          axis.text.x = element_text(colour="grey20",size=18,
                                     angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.text.y = element_text(colour="grey20",size=18,
                                     angle=0,hjust=0.5,vjust=0,face="plain"),
         plot.margin = unit(c(0.5,2,1,1), "cm"),
         strip.text.x = element_text(size = 18),
         panel.margin = unit(1, "lines"))
```

## Tanenhaus plot: CODA/Deaf

```{r coda-deaf-plot}
breaks <- seq(0,4000, by=500)
y_breaks <- seq(0.25,1.0, by = 0.25)
points <- seq(0,4000, by = 200)

ggplot(aes(x = to.n(Time.ms), y = mean_prop_looking, linetype = hearing_status_participant, 
           color = value_cat, shape = hearing_status_participant), 
       data = gv_coda) + 
    geom_rect(aes(xmin = 600, xmax = 2500, ymin = -Inf, ymax = Inf), alpha = 0.1, fill = "grey90", color = NA) +
    geom_line(data = filter(gv_coda, Time.ms %in% points), size=2) +
    geom_linerange(data = filter(gv_coda, Time.ms %in% points),
                   aes(ymin=mean_prop_looking - ci_low, 
                       ymax=mean_prop_looking + ci_high), size=0.5, alpha = 0.7) +
    geom_point(data = filter(gv_coda, to.n(Time.ms) %in% points), size=6, fill = "white") +
    scale_shape_manual(values = c(19, 21)) +
    scale_color_brewer(palette = "Set1", type = "qual") +
    xlim(0, 4000) +
    ylim(0,1) +
    geom_hline(yintercept = 0.33, linetype = "dashed") +
    xlab("Time in ms from onset of noun") +
    ylab("Proportion looking") +
    theme_bw() +
    guides(color = F, linetype = F, fill = F, shape = F) +
    theme(axis.title.x = element_text(colour="grey40",size=22,
                                      angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.title.y = element_text(colour="grey40",size=22,
                                      angle=90,hjust=0.5,vjust=0.5,face="plain"),
          axis.text.x = element_text(colour="grey20",size=18,
                                     angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.text.y = element_text(colour="grey20",size=18,
                                     angle=0,hjust=0.5,vjust=0,face="plain"),
         plot.margin = unit(c(0.5,2,1,1), "cm"))
```

### Scatter plots of individual differences

```{r plot correlations}
acc_age_plot <- qplot(x = Months, y = target_looking_no_signer, data = ss_kids,
      ylab=c("Window Accuracy"), 
      xlab=c("Child's Age (months)")) +
    ylim(0.44, 0.85) +
    xlim(15, 55) +
    geom_smooth(method = "lm", se=F, color="black", size = 1.5) +
    geom_point(color = "black", size = 5.5) +
    geom_point(color = "grey50", size = 4) +
    # annotate("text", x = 30, y = 0.8, label = paste("r =", acc_voc_r), size=8) +
    theme_bw() + 
    theme(axis.title.x = element_text(colour="grey30",size=22,
                                      angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.title.y = element_text(colour="grey30",size=22,
                                      hjust=0.5,vjust=0.5,face="plain"),
          axis.text.x = element_text(colour="grey20",size=18,
                                     angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.text.y = element_text(colour="grey20",size=18,
                                     angle=0,hjust=0.5,vjust=0,face="plain"),
          panel.grid.major=element_blank())

rt_age_plot <- qplot(x = Months, y = median_ct_rt, 
                     data = filter(ss_medians, age_group_collapsed == "Kids"),
      ylab=c("Reaction Time (ms)"), 
      xlab=c("Child's Age (months)")) +
    ylim(800, 1950)  +
    xlim(15, 55) +
    geom_smooth(method = "lm", se=F, color="black", size = 1.5) +
    geom_point(color = "black", size = 5.5) +
    geom_point(color = "grey50", size = 4) +
    # annotate("text", x = 30, y = 0.8, label = paste("r =", acc_voc_r), size=8) +
    theme_bw() + 
    theme(axis.title.x = element_text(colour="grey30",size=22,
                                      angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.title.y = element_text(colour="grey30",size=22,
                                      hjust=0.5,vjust=0.5,face="plain"),
          axis.text.x = element_text(colour="grey20",size=18,
                                     angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.text.y = element_text(colour="grey20",size=18,
                                     angle=0,hjust=0.5,vjust=0,face="plain"),
          panel.grid.major=element_blank())

acc_voc_plot <- qplot(x = signs_produced, y = target_looking_no_signer, data = ss_kids,
      ylab=c("Window Accuracy"), 
      xlab=c("Signs Produced")) +
    ylim(0.44, 0.85) +
    xlim(15, 85) +
    geom_smooth(method = "lm", se=F, color="black", size = 1.5) +
    geom_point(color = "black", size = 5.5) +
    geom_point(color = "grey50", size = 4) +
    #annotate("text", x = 30, y = 0.8, label = paste("r =", acc_voc_r), size=8) +
    theme_bw() + 
    theme(axis.title.x = element_text(colour="grey30",size=22,
                                      angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.title.y = element_text(colour="grey30",size=22,
                                      hjust=0.5,vjust=0.5,face="plain"),
          axis.text.x = element_text(colour="grey20",size=18,
                                     angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.text.y = element_text(colour="grey20",size=18,
                                     angle=0,hjust=0.5,vjust=0,face="plain"),
          panel.grid.major=element_blank())

rt_voc_plot <- qplot(x = signs_produced, y = median_ct_rt, data = ss_rt,
      ylab=c("Reaction Time (ms)"), 
      xlab=c("Signs Produced")) +
    ylim(800, 1950) +
    xlim(15, 85) +
    geom_smooth(method = "lm", se=F, color="black", size = 1.5) +
    geom_point(color = "black", size = 5.5) +
    geom_point(color = "grey50", size = 4) +
    #annotate("text", x = 65, y = 1750, label = paste("r =", rt_voc_r), size=8) +
    theme_bw() + 
    theme(axis.title.x = element_text(colour="grey30",size=22,
                                      angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.title.y = element_text(colour="grey30",size=22,
                                      hjust=0.5,vjust=0.5,face="plain"),
          axis.text.x = element_text(colour="grey20",size=18,
                                     angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.text.y = element_text(colour="grey20",size=18,
                                     angle=0,hjust=0.5,vjust=0,face="plain"),
          panel.grid.major=element_blank())

gridExtra::grid.arrange(acc_age_plot, rt_age_plot, ncol = 2)

gridExtra::grid.arrange(acc_voc_plot, rt_voc_plot, ncol = 2)

```

## Models and Stats

### Kids

```{r}
fit_rt1 <- lm(mean_correct_rt ~ signs_produced, data = ss_rt)
fit_rt2 <- lm(mean_correct_rt ~ signs_produced + age_peek_months, data = ss_rt)
fit_rt3 <- lm(mean_correct_rt ~ age_peek_months, data = ss_rt)
```

R-squared change when adding age to the model.

```{r}
summary(fit_rt2)$r.squared - summary(fit_rt3)$r.squared
```

### T.tests all analyses

```{r t-tests age}
t.test(mean_correct_rt ~ age_group, alternative = "two.sided", var.equal=T, 
       data = filter(ss_rt, value_cat == "Target"))

t.test(prop_looking ~ age_group, alternative = "two.sided", var.equal=T, 
       data = filter(ss_kids, value_cat == "Target"))

t.test(prop_looking ~ age_group, alternative = "two.sided", var.equal=T, 
       data = filter(ss_kids, value_cat == "Distractor"))

t.test(prop_looking ~ age_group, alternative = "two.sided", var.equal=T, 
       data = filter(ss_kids, value_cat == "Signer"))

t.test(mean_correct_rt ~ age_group_collapsed, alternative = "two.sided", var.equal = T, 
       data = filter(ss, value_cat == "Target"))

t.test(prop_looking ~ age_group_collapsed, alternative = "two.sided", var.equal = T, 
       data = filter(ss, value_cat == "Distractor"))

t.test(mean_accuracy ~ hearing_status_participant, alternative = "two.sided", var.equal=T, 
       data = ss_kids)

t.test(C_T_prop ~ hearing_status_participant, alternative = "two.sided", var.equal=T, 
       data = ss_kids)

t.test(mean_correct_rt ~ hearing_status_participant, alternative = "two.sided", var.equal=T, 
       data = ss_rt)
`