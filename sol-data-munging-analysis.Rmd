---
title: "SOL-data-munging-analysis"
author: "Kyle MacDonald"
date: "September 8, 2014"
output: html_document
---

## Data processing, plotting, and analysis script for SOL PEEK data 

Clear workspace

```{r clear workspace}
rm(list=ls())
```

### Read in data and do some minor cleaning

Load libraries
```{r load libraries, message=F, warning=F}
source("/Users/kmacdonald/Documents/programming/rscripts/RScripts_v_3.6/libraries_v_3.6.R")
source("/Users/kmacdonald/Documents/programming/rscripts/useful.R")
setwd("/Users/kmacdonald/Documents/Projects/SOL/SOL-Data/plots/srcd")
```

Set paths for loading data

```{r set paths}
path_v1 <- "/Users/kmacdonald/Documents/Projects/SOL/SOL-Data/SOL-raw-data/vanilla-1/"
path_v2 <- "/Users/kmacdonald/Documents/Projects/SOL/SOL-Data/SOL-raw-data/vanilla-2-fixed-orders/srcd-analysis/"
path_demo_v1 <- "/Users/kmacdonald/Documents/Projects/SOL/SOL-Data/"
path_demo_v2 <- "/Users/kmacdonald/Documents/Projects/SOL/SOL-Data/"
```

SOL-iChart-all-data.txt

Read in the raw data (iChart), which is exported from the DataWiz program. This iChart contains data from both kids and adults on the following PEEKs: Vanilla-1 (all Vanilla Trials), Incremental (prime, adjective, and vanilla trials -- all analyzed from noun onset). 

Vanilla-1

```{r read in data Van 1, message=F, warning=F}
iChart_1 <- readiChart(paste(path_v1, "SOL-iChart-all-data.txt", sep=""))
sol_demo_v1 <- read.csv(paste(path_demo_v1, "sol.demo.data.csv", sep=""))
```

Vanilla-2

```{r read data Van 2, message=F, warning=F}
iChart_2 <- readiChart(paste(path_v2, "sol-vanilla2-ichart-srcd.txt", sep=""))
sol_demo_v2 <- read.csv(paste(path_demo_v2, "sol-demo-van-2.csv", sep=""))
```

Next, we collapse all conditions to Vanilla and track experiment (Van1 vs. Van2). And create a column to 
track different age groups.

```{r revalue conditions}
iChart_1$Condition <- "vanilla-1"
iChart_2$Condition <- "vanilla-2"

# age groups
iChart_1$Months <- as.numeric(iChart_1$Months)
iChart_2$Months <- as.numeric(iChart_2$Months)

iChart_1$age_group <- ifelse(iChart_1$Months < 24 & iChart_1$Months >= 15, "< 24 Months", 
                  ifelse(iChart_1$Months >= 24 & iChart_1$Months <= 36 , "> 24 Months",
                  ifelse(iChart_1$Months > 100, "Adults", NA)))

iChart_2$age_group <- ifelse(iChart_2$Months < 24 & iChart_2$Months >= 15, "< 24 Months", 
                  ifelse(iChart_2$Months >= 24 & iChart_2$Months <= 36 , "> 24 Months",
                  ifelse(iChart_2$Months > 100, "Adults", NA)))
```

#### Data processing Vanilla-1

One child completed two PEEKs because the fire alarm went off after first 8 trials in PEEK1 -- here, we read in the data as two subjects (30036 and 99999) and now we revalue subject 99999 to be 30036. 

```{r munging}
# after running this, 30036 should have 22 vanilla trials and 99999 should no longer exist
iChart_1$Sub.Num[iChart_1$Sub.Num == "99999"]<- "30036" 
```

Get descriptives: the number of trials for each subject, ages, genders.

```{r descriptives van 1}
van1_descriptives <- iChart_1 %>%
                        group_by(Sub.Num, Months, Sex) %>%
                        summarise(Trials = n())
van1_descriptives
```

Filter out participants that should not go into the profile plot computation

```{r set up filters Vanilla 1}
include_v1 <- select(sol_demo_v1, Sub.Num, include)
iChart_1 <- merge(iChart_1, include_v1, by="Sub.Num")
iChart_1 <-filter(iChart_1, include == 1)
```

Checks the distribution of C, D, T, and A at F0

```{r distribution of responses}
iChart_1 %>% 
      group_by("0", Response) %>%
      summarise(Trials = n())
```

First, we need to process the data, removing prescreened out trials and keeping only those trials on which the child was looking at the signer at F0 go into Accuracy and RT computations. 

- C: Center
- D: Distractor
- T: Target
- A: Away

includeOffCenter == FALSE -> only include trials child was looking at center at F0

includeOffCenter == TRUE -> include trials child was looking at center, target, or distractor at F0 

```{r define onset and responses}
iChart_1 %>% 
      group_by(Response) %>%
      summarise(Trials = n())

## remove prescreened out trials
iChart_1 <- iChart_1[iChart_1$Prescreen.Notes == "",]

# check number of trials removed
iChart_1 %>% 
      group_by(Response) %>%
      summarise(Trials = n())

## define onset, changing Cs to Ds and everything else as As
iChart_1 <- defineOnsetSOL(iChart_1, critonset=0, includeOffCenter=FALSE)

## check iChart_1 after setting response (should only have Ds and As)
iChart_1 %>% 
      group_by(Response) %>%
      summarise(Trials = n())
```

### Compute Accuracy and RT (All subs)

Now we have our iChart_1 set up to only include C-initial trials, we can do our Accuracy computations. Here we don't filter any subjects out.

```{r compute statistics, warning=FALSE, message=FALSE}
# compute gaps
iChart_1 <- computeStatistics(iChart_1, startWindow=0, endWindow=3000)

# filter iChart_1: reject trials with extreme RT and gaps
iChart_1 <- filteriChart(iChart_1, minRT=300, maxRT=2000, maxfirstgap=15, maxlonggap=15)

## Compute accuracy for each subject
accuracy_1 <- poolData(meanAccuracy(iChart_1, startWindowAcc=300, endWindowAcc=2600), 
                     RejectFirstGap=TRUE,RejectLongestGap=TRUE, RejectRT=FALSE, 
                     color=TRUE, dependent="Accuracy", group="", facet="", dodge="", 
                     xlab="", ylab= "Proportion\n  Looking\n  to target", paired=TRUE, 
                     miny = 0.2, maxy = 0.80, size=13, legend.direction="horizontal", 
                     legend.position="bottom", breaks=c(0.25, 0.50, 0.75))

## Compute reaction time for each subject
RT_1 <- poolData(iChart_1[iChart_1$Response == "D",], RejectFirstGap=TRUE, RejectLongestGap=TRUE,
               RejectRT=TRUE, color=FALSE, dependent="RT", group="", facet="", dodge="Response",
               xlab="", ylab="mean RT (ms)", paired=TRUE, miny = 400, maxy=1300, size=13, 
               legend.direction = "horizontal", legend.position="bottom", 
               breaks=c(400, 800, 1200))
```

#### Profile plot and mean RT/Acc for different age groups

```{r profile plot full dataset, message=FALSE, warning=FALSE}
## profile plot with adults and two age groups for kids
iChart_1$Months <- as.numeric(iChart_1$Months)

## split sample into three groups based on age: young (< 24months, > 24months, adults)
iChart_1$Condition <- ifelse(iChart_1$Months < 24 & iChart_1$Months >= 15, "< 24 Months", 
                  ifelse(iChart_1$Months >= 24 & iChart_1$Months <= 36 , "> 24 Months",
                  ifelse(iChart_1$Months > 100, "Adults", NA)))

accuracy.by.cond.1 <- poolData(meanAccuracy(iChart_1, startWindowAcc=300, endWindowAcc=2600), 
                               RejectFirstGap=TRUE,RejectLongestGap=TRUE, 
                               RejectRT=FALSE, color=TRUE, dependent="Accuracy", 
                               group="", facet="", dodge="", 
                               xlab="", ylab= "Proportion\n  Looking\n  to target", 
                               paired=TRUE, miny = 0.2, maxy = 0.80, 
                               size=13, legend.direction="horizontal", 
                               legend.position="bottom", 
                               breaks=c(0.25, 0.50, 0.75))

## Compute reaction time for each age group
RT.by.cond.1 <- poolData(iChart_1[iChart_1$Response == "D",], 
                         RejectFirstGap=TRUE, RejectLongestGap=TRUE,
                         RejectRT=TRUE, color=FALSE, dependent="RT", group="", 
                         facet="", dodge="Response",
                         xlab="", ylab="mean RT (ms)", 
                         paired=TRUE, 
                         miny = 400, maxy=1300, 
                         size=13, 
                         legend.direction = "horizontal", 
                         legend.position="bottom", 
                         breaks=c(400, 800, 1200))

createPlots(iChart_1, startWindow=0, endWindow=3000, RejectLongestGap=FALSE, 
            RejectFirstGap=FALSE, RejectRT=FALSE, color=TRUE, smooth=400, 
            targetEnd=800, carrier="", targets=c(""), 
            group="",  plotStats="PP", miny = 0.4, maxy=0.95, size=15, 
            legend.direction = "vertical", legend.position=c(0.85, 0.9), 
            breaks=c(0.25, 0.50, 0.75), x.target=0.33)
```

#### Profile plot for each subject Vanilla-1

```{r pp by subs read in data van1}
detach("package:reshape", unload=TRUE)

gv.subs.v1 <- read.table("/Users/kmacdonald/Documents/Projects/SOL/SOL-Data/SOL-raw-data/vanilla-1/SOL-iChart-all-data.txt_PP_graphValues_by_subs_0_3000_minRT_100_maxRT_2933_lg_79_fg_26_n_35.txt", header = T)

# add variable to track experiment
gv.subs.v1$experiment <- "vanilla-1"

#strip X from header
names(gv.subs.v1) <- gsub("X", "", names(gv.subs.v1))

#get ages and vocabulary from demo, rename id to Sub.Num, and merge with graph values, 
age.voc.v1 <- select(sol_demo_v1, Sub.Num, age_months, signs_produced)
gv.subs.v1 <- left_join(gv.subs.v1, age.voc.v1, by="Sub.Num")

#melt to long form for plotting
gv.subs.v1.melt <- melt(gv.subs.v1, id.vars=c("Sub.Num", "Condition", "age_months", "signs_produced"),
                     variable.name = "Time.ms",
                     value.name = "accuracy")

#convert sub.num to a factor
gv.subs.v1.melt <- mutate(gv.subs.v1.melt, Sub.Num = as.factor(Sub.Num), 
                       Time.ms = as.numeric(as.character(Time.ms)),
                       age_months = as.factor(age_months),
                       accuracy = as.numeric(accuracy))
```

Now plot each subs data for Vanilla-1.

```{r pp plot by subs van1}
# set breaks for x-axis
breaks.v1 <- seq(0,4000, by=500)

# set up filters 
gv.less.24.v1 <- filter(gv.subs.v1.melt, Condition == "< 24 Months")
gv.more.24.v1 <- filter(gv.subs.v1.melt, Condition == "> 24 Months")
gv.adults <- filter(gv.subs.v1.melt, Condition == "Adults")

# get plots for ind subs younger than 24 months
pp.less.24.v1 <- qplot(data = gv.less.24.v1, x = Time.ms, y = accuracy, 
                              geom=c("point"), color=Sub.Num,
                              ylim=c(0.2,1), xlab=c("Time (ms) from noun onset"), 
                              ylab=c("Proportion Looking to target")) + 
                              geom_smooth(method="loess") +
                              geom_hline(yintercept = 0.5, linetype="dashed") +
                              scale_x_discrete(breaks = breaks.v1) +
                              facet_wrap(age_months~Sub.Num, ncol=4) +
                              guides(color=FALSE) +
                              geom_vline(xintercept=1200, linetype = "dashed") +
                              theme(axis.text.x = element_text(angle = 75, hjust = 1)) +
                              theme_bw()

# get plots for ind subs younger than 24 months
pp.greater.24.v1 <- qplot(data = gv.more.24.v1, x = Time.ms, y = accuracy, 
                              geom=c("point"), color=Sub.Num,
                              ylim=c(0.2,1), xlab=c("Time (ms) from noun onset"), 
                              ylab=c("Proportion Looking to target")) + 
                              geom_hline(yintercept = 0.5, linetype="dashed") +
                              geom_smooth(method="loess") +
                              scale_x_discrete(breaks = breaks.v1) +
                              facet_wrap(age_months~Sub.Num, ncol=3) +
                              guides(color=FALSE) +
                              geom_vline(xintercept=1200, linetype = "dashed") +
                              theme(axis.text.x = element_text(angle = 75, hjust = 1)) +
                              theme_bw()

# get plots for ind subs: adults
pp.adults <- qplot(data = gv.adults, x = Time.ms, y = accuracy, 
                              geom=c("point"), color=Sub.Num,
                              ylim=c(0.2,1), xlab=c("Time (ms) from noun onset"), 
                              ylab=c("Proportion Looking to target")) + 
                              geom_hline(yintercept = 0.5, linetype="dashed") +
                              geom_smooth(method="loess") +
                              scale_x_discrete(breaks = breaks.v1) +
                              facet_wrap(age_months~Sub.Num, ncol=3) +
                              guides(color=FALSE) +
                              geom_vline(xintercept=1200, linetype = "dashed") +
                              theme(axis.text.x = element_text(angle = 75, hjust = 1)) +
                              theme_bw()

multiplot(pp.less.24.v1, pp.greater.24.v1, pp.adults, cols=3)
```

#### Data processing Vanilla-2

Get descriptives: the number of trials for each subject, ages, genders.

```{r descriptives van2}
van2_descriptives <- iChart_2 %>%
            group_by(Sub.Num, Months, Sex) %>%
            summarise(Trials = n())

van2_descriptives
```

Checks the distribution of C, D, T, and A at F0

```{r distribution of responses van2}
iChart_2 %>% 
      group_by("0", Response) %>%
      summarise(Trials = n())
```

Check how many participants in Van2 were also in Van 1 dataset.

```{r check van2 for van1 subs}
subs_in_both <- intersect(van1_descriptives$Sub.Num, van2_descriptives$Sub.Num)
length(subs_in_both)
subs_in_both 
```

Filter out adults who weren't doing the task (below chance performance on accuracy),
and children who participated in both rounds of data collection (V1 and V2).

```{r filter adults and repeats}
# adults below chance
below_chance <- c(30070, 30077, 30080, 30083, 30086, 30088)
iChart_2 <- iChart_2 %>% 
    mutate(below_chance = ifelse(Sub.Num %in% below_chance, "yes", "no")) %>%
    filter(below_chance == "no", Sub.Num != 30077)

# flag and remove duplicates 
dups_V2 <- c(30013, 30017, 30024, 30031, 30041, 30048)
iChart_2 <- iChart_2 %>% 
    mutate(duplicate = ifelse(Sub.Num %in% dups_V2, "yes", "no")) %>%
    filter(duplicate == "no")

# filter 
include_v2 <- select(sol_demo_v2, Sub.Num, include)
iChart_2 <- merge(iChart_2, include_v2, by="Sub.Num")
iChart_2 <- filter(iChart_2, include == 1)
```


First, we need to process the data, removing prescreened out trials and keeping only those trials on which the child was looking at the signer at F0 go into Accuracy and RT computations. 

- C: Center
- D: Distractor
- T: Target
- A: Away

includeOffCenter == FALSE -> only include trials child was looking at center at F0

includeOffCenter == TRUE -> include trials child was looking at center, target, or distractor at F0 

```{r define onset and responses van2}
library(reshape)

iChart_2 %>% 
      group_by(Response) %>%
      summarise(Trials = n())

## remove prescreened out trials
iChart_2 <- iChart_2[iChart_2$Prescreen.Notes == "",]

# check number of trials removed
iChart_2 %>% 
      group_by(Response) %>%
      summarise(Trials = n())

## define onset, changing Cs to Ds and everything else as As
iChart_2 <- defineOnsetSOL(iChart_2, critonset=0, includeOffCenter=FALSE)

## check iChart_2 after setting response (should only have Ds and As)
iChart_2 %>% 
      group_by(Response) %>%
      summarise(Trials = n())
```

### Compute Accuracy and RT (All subs) Vanilla-2

Now we have our iChart_2 set up to only include C-initial trials, we can do our Accuracy computations. Here we don't filter any subjects out.

```{r compute accuracy van2, warning=FALSE, message=FALSE}
# compute gaps
iChart_2 <- computeStatistics(iChart_2, startWindow=0, endWindow=3000)

# filter iChart_2: reject trials with extreme RT and gaps
iChart_2 <- filteriChart(iChart_2, minRT=300, maxRT=2000, maxfirstgap=15, maxlonggap=15)

## Compute accuracy for each subject
accuracy_2 <- poolData(meanAccuracy(iChart_2, startWindowAcc=300, endWindowAcc=2600), 
                     RejectFirstGap=TRUE,RejectLongestGap=TRUE, RejectRT=FALSE, 
                     color=TRUE, dependent="Accuracy", group="", facet="", dodge="", 
                     xlab="", ylab= "Proportion\n  Looking\n  to target", paired=TRUE, 
                     miny = 0.2, maxy = 0.80, size=13, legend.direction="horizontal", 
                     legend.position="bottom", breaks=c(0.25, 0.50, 0.75))

## Compute reaction time for each subject
RT_2 <- poolData(iChart_2[iChart_2$Response == "D",], RejectFirstGap=TRUE, RejectLongestGap=TRUE,
               RejectRT=TRUE, color=FALSE, dependent="RT", group="", facet="", dodge="Response",
               xlab="", ylab="mean RT (ms)", paired=TRUE, miny = 400, maxy=1300, size=13, 
               legend.direction = "horizontal", legend.position="bottom", 
               breaks=c(400, 800, 1200))
```

#### Compute Mean RT/ACC for Vanilla-2 for each age group

```{r profile plot van2, message=FALSE, warning=FALSE}
## profile plot with adults ange two age groups for kids
iChart_2$Months <- as.numeric(iChart_2$Months)

## split sample into three groups based on age: young (< 24months, > 24months, adults)
iChart_2$Condition <- ifelse(iChart_2$Months < 24, "< 24 Months", 
                  ifelse(iChart_2$Months >= 24 & iChart_2$Months <=36 , "> 24 Months",
                  ifelse(iChart_2$Months > 100, "Adults", NA)))

accuracy.by.cond.2 <- poolData(meanAccuracy(iChart_2, startWindowAcc=300, endWindowAcc=2600), 
                     RejectFirstGap=TRUE,RejectLongestGap=TRUE, RejectRT=FALSE, 
                     color=TRUE, dependent="Accuracy", group="", facet="", dodge="", 
                     xlab="", ylab= "Proportion\n  Looking\n  to target", paired=TRUE, 
                     miny = 0.2, maxy = 0.80, size=13, legend.direction="horizontal", 
                     legend.position="bottom", breaks=c(0.25, 0.50, 0.75))

## Compute reaction time for each subject

# filter out subject 30050 from RT computation 
iChart_2_rt_filt <- filter(iChart_2, Sub.Num != 30050)

RT.by.cond.2 <- poolData(iChart_2_rt_filt[iChart_2_rt_filt$Response == "D",], RejectFirstGap=TRUE, 
                         RejectLongestGap=TRUE,RejectRT=TRUE, color=FALSE, dependent="RT", group="", 
                         facet="", dodge="Response",xlab="", ylab="mean RT (ms)", paired=TRUE, 
                         miny = 400, maxy=1300, size=13, legend.direction = "horizontal", 
                         legend.position="bottom", breaks=c(400, 800, 1200))

createPlots(iChart_2, startWindow=0, endWindow=3000, RejectLongestGap=FALSE, 
            RejectFirstGap=FALSE, RejectRT=FALSE, color=TRUE, smooth=400, 
            targetEnd=800, carrier="", targets=c(""), 
            group="",  plotStats="PP", miny = 0.4, maxy=0.95, size=15, 
            legend.direction = "vertical", legend.position=c(0.85, 0.9), 
            breaks=c(0.25, 0.50, 0.75), x.target=0.33)
```

#### Profile plot for each subject Vanilla-2

```{r pp by subs read in data van2}
detach("package:reshape")

gv.subs.v2 <- read.table("/Users/kmacdonald/Documents/Projects/SOL/SOL-Data/SOL-raw-data/vanilla-2-fixed-orders/srcd-analysis/sol-vanilla2-ichart-srcd.txt_PP_graphValues_by_subs_0_3000_minRT_33_maxRT_2967_lg_58_fg_34_n_18.txt", header = T)

#strip X from header
names(gv.subs.v2) <- gsub("X", "", names(gv.subs.v2))

# add variable to track experiment
gv.subs.v2$experiment <- "vanilla-2"

#get ages and vocabulary from demo, rename id to Sub.Num, and merge with graph values, 
age.voc.v2 <- select(sol_demo_v2, Sub.Num, age_months, signs_produced)
gv.subs.v2 <- merge(gv.subs.v2, age.voc.v2, by="Sub.Num")

#melt to long form for plotting
gv.subs.v2.melt <- melt(gv.subs.v2, id.vars=c("Sub.Num", "Condition", "age_months"),
                     variable.name = "Time.ms",
                     value.name = "accuracy")

#convert sub.num to a factor
gv.subs.v2.melt <- mutate(gv.subs.v2.melt, Sub.Num = as.factor(Sub.Num), 
                       Time.ms = as.numeric(as.character(Time.ms)),
                       age_months = as.factor(age_months), 
                       accuracy = as.numeric(accuracy))
```

Now plot individual subject data for Vanilla-2.

```{r pp plot by subs van2}
# set breaks for x-axis
breaks.v2 <- seq(0,3000, by=500)

# set up filters 
gv.less.24.v2 <- filter(gv.subs.v2.melt, Condition == "< 24 Months")
gv.more.24.v2 <- filter(gv.subs.v2.melt, Condition == "> 24 Months")
gv.adults.v2 <- filter(gv.subs.v2.melt, Condition == "Adults")

# get plots for ind subs younger than 24 months
pp.less.24.v2 <- qplot(data = gv.less.24.v2, x = Time.ms, y = accuracy, 
                       geom=c("point"), color=Sub.Num,
                              ylim=c(0.2,1), xlab=c("Time (ms) from noun onset"), 
                              ylab=c("Proportion Looking to target")) + 
                           geom_hline(yintercept = 0.5, linetype="dashed") +
                           geom_smooth(method="loess") +
                           scale_x_discrete(breaks = breaks.v2) +
                           facet_wrap(age_months~Sub.Num, ncol=2) +
                           guides(color=FALSE) +
                           geom_vline(xintercept=1200, linetype = "dashed") +
                           theme(axis.text.x = element_text(angle = 75, hjust = 1)) 

# get plots for ind subs younger than 24 months
pp.greater.24.v2 <- qplot(data = gv.more.24.v2, x = Time.ms, y = accuracy, 
                          geom=c("point"), color=Sub.Num,
                          ylim=c(0.2,1), xlab=c("Time (ms) from noun onset"), 
                          ylab=c("Proportion Looking to target")) + 
    geom_hline(yintercept = 0.5, linetype="dashed") +
    geom_smooth(method="loess") +
    scale_x_discrete(breaks = breaks.v2) +
    facet_wrap(age_months~Sub.Num, ncol=3) +
    guides(color=FALSE) +
    geom_vline(xintercept=1200, linetype = "dashed") +
    theme(axis.text.x = element_text(angle = 75, hjust = 1)) 

# get plots for adults
pp.adults.v2 <- qplot(data = gv.adults.v2, x = Time.ms, y = accuracy, 
                      geom=c("point"), color=Sub.Num,
                      ylim=c(0.2,1), xlab=c("Time (ms) from noun onset"), 
                      ylab=c("Proportion Looking to target")) + 
    geom_hline(yintercept = 0.5, linetype="dashed") +
    geom_smooth(method="loess") +
    scale_x_discrete(breaks = breaks.v2) +
    facet_wrap(age_months~Sub.Num, ncol=3) +
    guides(color=FALSE) +
    geom_vline(xintercept=1200, linetype = "dashed") +
    theme(axis.text.x = element_text(angle = 75, hjust = 1)) 

multiplot(pp.less.24.v2, pp.greater.24.v2, pp.adults.v2, cols=3)
```

#### Vizualize differences between Van-1 and Van-2

```{r van-1 vs. van-2 load in graph values}
#read in van1 and van2 graph values
gv.van1 <- tbl_df(read.table("/Users/kmacdonald/Documents/Projects/SOL/SOL-Data/SOL-raw-data/vanilla-1/SOL-iChart-all-data.txt_PP_graphValues_0_3000_minRT_100_maxRT_2933_lg_79_fg_26_n_35.txt", header=T))

gv.van2 <- tbl_df(read.table("/Users/kmacdonald/Documents/Projects/SOL/SOL-Data/SOL-raw-data/vanilla-2-fixed-orders/srcd-analysis/sol-vanilla2-ichart-srcd.txt_PP_graphValues_0_3000_minRT_33_maxRT_2967_lg_58_fg_34_n_18.txt", header = T))

#filter van1 to just include 0-3000 msec
gv.van1 <- select(gv.van1, 1:78)
gv.van2 <- select(gv.van2, 1:78)

#add column to track van1 vs. van2
gv.van1 <- mutate(gv.van1, Experiment = "Vanilla.1")
gv.van2 <- mutate(gv.van2, Experiment = "Vanilla.2")

#strip X from header
names(gv.van1) <- gsub("X", "", names(gv.van1))
names(gv.van2) <- gsub("X", "", names(gv.van2))

#bind together into one data frame
gv.all <- rbind(gv.van1, gv.van2)
```

Now that we have the graph values for Van-1 and Van-2 in the same data frame, we need to melt it to long form for plotting.

```{r melt graph values van1 and van2}
#melt to long form for plotting
gv.melt <- melt(gv.all, id.vars=c("Condition", "Experiment", "statistic"),
                     variable.name = "Time.ms",
                     value.name = "value")
#convert experiment and time.ms to a factor
gv.melt <- mutate(gv.melt, Experiment = as.factor(Experiment), 
                       Time.ms = as.numeric(as.character(Time.ms)))

#spread statistic (mean/se)
gv.melt <- spread(statistic, value, data=gv.melt)
```

Now we plot.

```{r PP van1 vs. van2}
breaks <- seq(0,2500, by=500)

# set limits for error bars
limits <- aes(ymax = mean + se, ymin= mean - se)

qplot(data = gv.melt, x = Time.ms, y = mean, color=Condition,
                              ylim=c(0.2,1), xlab=c("Time (ms) from noun onset"), 
                              ylab=c("Proportion Looking to target")) +
                              geom_hline(yintercept = 0.5, linetype="dashed") +
                              geom_smooth(limits, method="loess") +
                              scale_x_discrete(breaks = breaks) +
                              geom_vline(xintercept=1200, linetype = "dashed")+
                              facet_grid(.~Experiment) +
                              theme(axis.text.x = element_text(hjust = 1)) 
```

## Collapse V1 and V2 - profile plot

```{r v1-v2 pp}
# merge
gv.subs.all <- rbind(gv.subs.v1, gv.subs.v2)

# descriptives
gv.subs.all %>%
    group_by(Condition) %>%
    summarise(n())

# melt to long form to compute means
gv.subs.all.melt <- melt(gv.subs.all, 
                         id.vars=c("Sub.Num", "Condition", 
                                   "age_months","signs_produced", 
                                   "experiment"),
                         variable.name = "Time.ms",
                         value.name = "value")

# compute means and CIs for each condition at each time slice
ms.all <- gv.subs.all.melt %>%
    group_by(Condition, Time.ms) %>%
    summarise(mean = mean(value),
              se = sem(value))

# compute means and CIs for all kids
ms.all.kids <- gv.subs.all.melt %>%
    filter(Condition != "Adults") %>%
    mutate(Condition = "15-36 Months") %>%
    group_by(Condition, Time.ms) %>%
    summarise(mean = mean(value),
              se = sem(value))
    
```

Now plot

```{r SRCD pp collapsed experiments}
# convert time back to a numeric
ms.all$Time.ms <- as.numeric(as.character(ms.all$Time.ms))
ms.all.kids$Time.ms <- as.numeric(as.character(ms.all.kids$Time.ms))

# select window: 0-2500
breaks <- seq(0,2500, by=500)
plot_points <- c(0, breaks[2:6]-200)
ms.all.0.2500 <- filter(ms.all, Time.ms <= 2400)
ms.all.kids <- filter(ms.all.kids, Time.ms <= 2400) 
ms.breaks.kids <- filter(ms.all.kids, Time.ms %in% plot_points)
ms.breaks <- filter(ms.all, Time.ms %in% plot_points)

# set limits for error bars
limits <- aes(ymax = mean + se, ymin= mean - se)

sol.pp.all.kids <- qplot(data = ms.all.kids, x = Time.ms, y = mean, color=Condition, 
      ylim=c(0.35,1), xlab=c("Time (ms) from noun onset"),
      geom="line",ylab=c("Proportion Looking \n to Target")) +
    geom_point(data=ms.breaks.kids, aes(x = Time.ms, y = mean, shape=Condition, size=1)) +
    geom_linerange(data=ms.breaks.kids, limits) +
    geom_hline(yintercept = 0.5, linetype="dashed") +
    scale_x_discrete(breaks = breaks) +
    geom_vline(xintercept=1200, linetype = "dashed") +
    scale_size_continuous(guide=FALSE) +
    scale_shape_discrete(guide=FALSE) + 
    scale_color_manual(name="Age Group", values=c("#e41a1c")) +
    theme(axis.title.x = element_text(colour="black",size=16,angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.title.y = element_text(colour="black",size=16,angle=0,hjust=0.5,vjust=0.5,face="plain"),
        axis.text.x = element_text(colour="grey20",size=12,angle=0,hjust=0.5,vjust=0,face="plain"),
        axis.text.y = element_text(colour="grey20",size=12,angle=0,hjust=0.5,vjust=0,face="plain"),
        legend.position=c(0.85,0.85),
        legend.text = element_text(size=13),
        legend.title = element_text(size=13, face="bold"))

ggsave("sol-pp-all-kids.pdf", sol.pp.all.kids, width=8, height=5)


sol.pp.median.split <- qplot(data = filter(ms.all.0.2500, Condition != "Adults"), x = Time.ms, y = mean, color=Condition, 
      ylim=c(0.35,1), xlab=c("Time (ms) from noun onset"),
      geom="line",ylab=c("Proportion Looking \n to Target")) +
    geom_point(data=filter(ms.breaks, Condition != "Adults"), aes(x = Time.ms, y = mean, shape=Condition, size=1)) +
    geom_linerange(data=filter(ms.breaks, Condition != "Adults"), limits) +
    geom_hline(yintercept = 0.5, linetype="dashed") +
    scale_x_discrete(breaks = breaks) +
    geom_vline(xintercept=1200, linetype = "dashed") +
    scale_size_continuous(guide=FALSE) +
    scale_shape_discrete(guide=FALSE) + 
    scale_color_manual(name="Age Group", values=c("#e41a1c", "#4daf4a")) +
    theme(axis.title.x = element_text(colour="black",size=16,angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.title.y = element_text(colour="black",size=16,angle=0,hjust=0.5,vjust=0.5,face="plain"),
        axis.text.x = element_text(colour="grey20",size=12,angle=0,hjust=0.5,vjust=0,face="plain"),
        axis.text.y = element_text(colour="grey20",size=12,angle=0,hjust=0.5,vjust=0,face="plain"),
        legend.position=c(0.85,0.85),
        legend.text = element_text(size=13),
        legend.title = element_text(size=13, face="bold"))

ggsave("sol-pp-median-split.pdf", sol.pp.median.split, width=8, height=5)

sol.pp.kids.adults <- qplot(data = ms.all.0.2500, x = Time.ms, y = mean, color=Condition, 
      ylim=c(0.35,1), xlab=c("Time (ms) from noun onset"),
      geom="line",ylab=c("Proportion Looking \n to Target")) +
    geom_point(data=ms.breaks, aes(x = Time.ms, y = mean, shape=Condition, size=1)) +
    geom_linerange(data=ms.breaks, limits) +
    geom_hline(yintercept = 0.5, linetype="dashed") +
    scale_x_discrete(breaks = breaks) +
    geom_vline(xintercept=1200, linetype = "dashed") +
    scale_size_continuous(guide=FALSE) +
    scale_shape_discrete(guide=FALSE) + 
    scale_color_manual(name="Age Group", values=c("#e41a1c", "#4daf4a", "#377eb8")) +
      theme(axis.title.x = element_text(colour="black",size=16,angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.title.y = element_text(colour="black",size=16,angle=0,hjust=0.5,vjust=0.5,face="plain"),
        axis.text.x = element_text(colour="grey20",size=12,angle=0,hjust=0.5,vjust=0,face="plain"),
        axis.text.y = element_text(colour="grey20",size=12,angle=0,hjust=0.5,vjust=0,face="plain"),
        legend.position=c(0.85,0.85),
        legend.text = element_text(size=13),
        legend.title = element_text(size=13, face="bold"))

ggsave("sol-pp-kids.adults.pdf", sol.pp.kids.adults, width=8, height=5)
```

## Flag C-T vs. C-D Trials for both Van1 and Van2

```{r flag c-t and c-d}
# create function for flagging these trial types
trial_type_fun <- function(trial) { 
      start_col <- which(names(trial)=="0")
      end_col <- which(names(trial)=="3000")
      trial_type <- "no-shift"
      for (col in start_col:end_col) {
            curr_val <- trial[col]
            next_val <- trial[col+1]
            
            if(curr_val == "." & next_val %in% c("0", "1", "0.5", ".5")) {
                  if(next_val == "1") {
                        trial_type <- "C-T"
                        } else if(next_val == "0.5" | next_val == ".5") {
                            trial_type <- "C-C"
                              } else {
                                trial_type <- "C-D"    
                              }
                  break
                  }
            }
      return(trial_type)
}
```

Compute RTs for C-T, C-D separately

```{r RT ct cd Vanilla 1}
# filter out trials where child wasn't on center at F0
iChart_1_c <- filter(iChart_1, Response == "D")
iChart_2_c <- filter(iChart_2, Response == "D")

# compute gaps
iChart_1_c <- computeStatistics(iChart_1, startWindow=0, endWindow=3000)

# filter iChart_1: reject trials with extreme RT and gaps
iChart_1_c <- filteriChart(iChart_1_c, minRT=300, maxRT=2000, maxfirstgap=15, maxlonggap=15)

# now we need to apply it to each row in our dataset
trial_types_v1 <- apply(iChart_1_c, 1, trial_type_fun) 

# now we need to merge this information back with the iChart
iChart_1_c <- cbind(iChart_1_c, trial_types_v1)

# change condition to Vanilla
iChart_1_c$Condition <- "vanilla"

## Compute accuracy for each subject
library(reshape)
accuracy_1_c <- poolData(meanAccuracy(iChart_1_c, startWindowAcc=300, endWindowAcc=2600), 
                     RejectFirstGap=TRUE,RejectLongestGap=TRUE, RejectRT=FALSE, 
                     color=TRUE, dependent="Accuracy", group="", facet="", dodge="", 
                     xlab="", ylab= "Proportion\n  Looking\n  to target", paired=TRUE, 
                     miny = 0.2, maxy = 0.80, size=13, legend.direction="horizontal", 
                     legend.position="bottom", breaks=c(0.25, 0.50, 0.75))

## Compute reaction time for each subject
RT_1_c <- poolData(iChart_1_c, RejectFirstGap=TRUE, RejectLongestGap=TRUE,
               RejectRT=TRUE, color=FALSE, dependent="RT", group="", facet="trial_types_v1", 
               dodge="Response",
               xlab="", ylab="mean RT (ms)", paired=TRUE, miny = 400, maxy=1300, size=13, 
               legend.direction = "horizontal", legend.position="bottom", 
               breaks=c(400, 800, 1200))
```

Now do the same thing for Vanilla-2

```{r RT ct cd Vanilla 2}
# compute gaps
iChart_2_c <- computeStatistics(iChart_2_c, startWindow=0, endWindow=3000)

# filter iChart_1: reject trials with extreme RT and gaps
iChart_2_c <- filteriChart(iChart_2_c, minRT=300, maxRT=2000, maxfirstgap=15, maxlonggap=15)

# change condition to Vanilla
iChart_2_c$Condition <- "vanilla"

# apply ct/cd flagging function 
trial_types_v2 <- apply(iChart_2_c, 1, trial_type_fun) 
iChart_2_c <- cbind(iChart_2_c, trial_types_v2)

## Compute accuracy for each subject
library(reshape)
accuracy_2_c <- poolData(meanAccuracy(iChart_2_c, startWindowAcc=300, endWindowAcc=2600), 
                     RejectFirstGap=TRUE,RejectLongestGap=TRUE, RejectRT=FALSE, 
                     color=TRUE, dependent="Accuracy", group="", facet="", dodge="", 
                     xlab="", ylab= "Proportion\n  Looking\n  to target", paired=TRUE, 
                     miny = 0.2, maxy = 0.80, size=13, legend.direction="horizontal", 
                     legend.position="bottom", breaks=c(0.25, 0.50, 0.75))

## Compute reaction time for each subject
RT_2_c <- poolData(iChart_2_c, RejectFirstGap=TRUE, RejectLongestGap=TRUE,
               RejectRT=TRUE, color=FALSE, dependent="RT", group="", facet="trial_types_v2", 
               dodge="Response",
               xlab="", ylab="mean RT (ms)", paired=TRUE, miny = 400, maxy=1300, size=13, 
               legend.direction = "horizontal", legend.position="bottom", 
               breaks=c(400, 800, 1200))
```


### Summarise and plot the proportion of C-T and C-D for Van1.

```{r c-t c-d summarise subject level}
detach("package:reshape", unload=TRUE)
ss_ct_cd_v1 <- iChart_1_c %>%
      group_by(Sub.Num, trial_types_v1) %>%
      summarise(count = n()) %>%
      mutate(n_trial = sum(count),
             experiment = "Vanilla.1",
             prop_sub = count / n_trial)

# get age group information 
age_groups_v1 <- iChart_1_c %>% 
      group_by(Sub.Num) %>%
      select(Sub.Num, age_group, Months) %>%
      distinct()

# add to table
ss_ct_cd_v1 <- merge(ss_ct_cd_v1, age_groups_v1, by="Sub.Num")

# get the total number of trials where there was a shift for each kid
n_trial_shift_v1 <- ss_ct_cd_v1 %>%
      group_by(Sub.Num) %>%
      filter(trial_types_v1 == "C-T" | trial_types_v1 == "C-D") %>%
      summarise(n_trial_shift = sum(count)) %>%
      select(Sub.Num, n_trial_shift)

# merge with ss data frame
ss_ct_cd_v1 <- merge(ss_ct_cd_v1, n_trial_shift_v1)

# now do the same thing for van2
ss_ct_cd_v2 <- iChart_2_c %>%
      group_by(Sub.Num, trial_types_v2) %>%
      summarise(count = n()) %>%
      mutate(n_trial = sum(count),
             experiment = "Vanilla.2",
             prop_sub = count / n_trial)

# add in age group information 
age_groups_v2 <- iChart_2_c %>% 
      group_by(Sub.Num) %>%
      select(Sub.Num, age_group, Months) %>%
      distinct()

ss_ct_cd_v2 <- merge(ss_ct_cd_v2, age_groups_v2, by="Sub.Num")

# get the total number of trials where there was a shift for each kid
n_trial_shift_v2 <- ss_ct_cd_v2 %>%
      group_by(Sub.Num) %>%
      filter(trial_types_v2 == "C-T" | trial_types_v2 == "C-D") %>%
      summarise(n_trial_shift = sum(count)) %>%
      select(Sub.Num, n_trial_shift)

# merge with ss data frame
ss_ct_cd_v2 <- merge(ss_ct_cd_v2, n_trial_shift_v2)

# revalue trial types variable for merging
ss_ct_cd_v1 <- rename(ss_ct_cd_v1, trial_type = trial_types_v1)
ss_ct_cd_v2 <- rename(ss_ct_cd_v2, trial_type = trial_types_v2)

# merge for plotting
ss_ct_cd_all <- rbind(ss_ct_cd_v1, ss_ct_cd_v2)

# compute proportion correct for trials with shifts for each subject
ss_ct_cd_all_shifts <- ss_ct_cd_all %>%
    filter(trial_type == "C-T" | trial_type == "C-D") %>%
    mutate(prop_shift = count / n_trial_shift) %>%
    arrange(Sub.Num)
```

Next we compute mean proportion of trials on which kids did C-T, C-D, or didn't shift.

```{r c-t c-d summarise age_group level}
ms_ct_cd_age_group <- ss_ct_cd_all_shifts %>%
      group_by(trial_type, experiment, age_group) %>%
      summarise(mean_prop = mean(prop_shift),
                ci.high = ci.high(prop_shift),
                ci.low = ci.low(prop_shift))
```

Now that we have our summary table by age groups, we can plot.

```{r c-t c-d age_group plot}
# reorder factor levels for plotting
ms_ct_cd_age_group$trial_type <- factor(ms_ct_cd_age_group$trial_type, 
                              levels = c("no-shift", "C-D", "C-T", "C-C"))

# create filter for just plotting proportions when child shifted in the window
ms_ctd_filt_age_group <- filter(ms_ct_cd_age_group, trial_type != "no-shift", trial_type != "C-C")

# filter out NAs (kids who were older than 36 months)
ms_ct_cd_age_group <- filter(ms_ct_cd_age_group, age_group != "NA")
ms_ctd_filt_age_group <- filter(ms_ctd_filt_age_group, age_group != "NA")

limits <- aes(ymax = mean_prop + ci.high, ymin= mean_prop - ci.low)

qplot(data=ms_ctd_filt_age_group, x=age_group, y=mean_prop, fill=trial_type,
                      geom=c("bar"), stat="identity", position = "dodge", ylim=c(0,1),
                      xlab=c("Experiment"),
                      ylab=c("Proportion of trials"),
                      facets=(. ~ experiment)) +
      geom_linerange(limits, width=0.1, position=position_dodge(.9))
```

Now collapse across the two experiments

```{r ms ct cd collapsed}
ms_ct_cd_collapsed <- ss_ct_cd_all_shifts %>%
      group_by(trial_type, age_group) %>%
      summarise(mean_prop = mean(prop_shift),
                ci.high = ci.high(prop_shift),
                ci.low = ci.low(prop_shift))
```

Now plot

```{r c-t c-d plot values}
# reorder factor levels for plotting
ms_ct_cd_collapsed$trial_type <- factor(ms_ct_cd_collapsed$trial_type, 
                              levels = c("no-shift", "C-T", "C-D"))

# create filter for just plotting proportions when child shifted in the window
ms_ct_cd_filt_collapsed <- filter(ms_ct_cd_collapsed, trial_type != "no-shift")

# filter out NAs (kids who were older than 36 months)
ms_ct_cd_filt_collapsed <- filter(ms_ct_cd_filt_collapsed, age_group != "NA")
```

```{r SRCD ct-cd plot}
limits <- aes(ymax = mean_prop + ci.high, ymin= mean_prop - ci.low)

# change factor labels
levels(ms_ct_cd_filt_collapsed$trial_type)[levels(ms_ct_cd_filt_collapsed$trial_type)=="no-shift"] <- "No-Shift"
levels(ms_ct_cd_filt_collapsed$trial_type)[levels(ms_ct_cd_filt_collapsed$trial_type)=="C-T"] <- "Center-Target"
levels(ms_ct_cd_filt_collapsed$trial_type)[levels(ms_ct_cd_filt_collapsed$trial_type)=="C-D"] <- "Center-Distractor"

sol.ct.cd.plot <- qplot(data=filter(ms_ct_cd_filt_collapsed, trial_type=="Center-Target"), x=age_group, y=mean_prop,
                        geom=c("bar"), stat="identity", position = "dodge", ylim=c(0,1),
                        xlab=c("Age Group"),
                        ylab=c("Proportion \n of trials")) +
    geom_linerange(limits, width=0.1, position=position_dodge(.9)) +
    theme(axis.title.x = element_text(colour="black",size=20,angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.title.y = element_text(colour="black",size=20,angle=0,hjust=0.5,vjust=0.5,face="plain"),
          axis.text.x = element_text(colour="grey20",size=14,angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.text.y = element_text(colour="grey20",size=14,angle=0,hjust=0.5,vjust=0,face="plain"),
          legend.position=c(0.2,0.85),
          legend.text = element_text(size=9),
          legend.title = element_text(size=9, face="bold"))

ggsave("sol-ct-cd-prop.pdf", sol.ct.cd.plot, width=6, height=3.5)
```

#### Mean Accuracy and RT Collapsed Van1-Van2

Get mean accuracy and rt for each participant

Some munging to get data frame to do analysis. 
Variables needed for each subject:
- Mean acc
- Mean rt
- Signs produced
- Age
- Age condition 

```{r mean acc and rt munging}
# merge acc/rt van1
ss_van1 <- merge(accuracy_1, RT_1_c, by="Sub.Num")

# merge with demo info
ss_van1 <- merge(ss_van1, sol_demo_v1, by="Sub.Num")

# clean up data frame
ss_van1 <- ss_van1 %>% mutate(experiment = "vanilla-1")
names(ss_van1)[names(ss_van1)=="vanilla-1"] <- "mean_accuracy"
names(ss_van1)[names(ss_van1)=="vanilla_C-D_D"] <- "mean_cd_rt"
names(ss_van1)[names(ss_van1)=="vanilla_C-T_D"] <- "mean_ct_rt"
names(ss_van1)[names(ss_van1)=="vanilla_C-C_D"] <- "mean_cc_rt"

# acc van2
ss_van2 <- merge(accuracy_2, RT_2_c, by="Sub.Num")

# merge with demo info
ss_van2 <- merge(ss_van2, sol_demo_v2, by="Sub.Num")

# clean up
ss_van2 <- ss_van2 %>% mutate(experiment = "vanilla-2") 
ss_van2$mean_cc_rt <- NULL
names(ss_van2)[names(ss_van2)=="vanilla-2"] <- "mean_accuracy"
names(ss_van2)[names(ss_van2)=="vanilla_C-D_D"] <- "mean_cd_rt"
names(ss_van2)[names(ss_van2)=="vanilla_C-T_D"] <- "mean_ct_rt"

# merge V1 and V2 to get final data frame
ss_collapsed <- rbind(ss_van1, ss_van2)
```

Now create age bins.

```{r create age bins}
ss_collapsed$Age_Bin <- ifelse(ss_collapsed$age_months < 24 & 
                           ss_collapsed$age_months >= 15, "< 24 months", 
                       ifelse(ss_collapsed$age_months >= 24 & 
                                  ss_collapsed$age_months <= 36 , "> 24 months",
                              ifelse(ss_collapsed$age_months > 100, "Adults", NA)))
```

Scatter plots with full dataset

```{r filters for SRCD models and corrrelations}
ss_collapsed_acc <- filter(ss_collapsed, 
                           include==1, 
                           Age_Bin != "NA", 
                           Age_Bin != "Adults",
                           age_months <= 36)

ss_collapsed_cdi <- filter(ss_collapsed, 
                           include==1, 
                           Age_Bin != "NA", 
                           Age_Bin != "Adults",
                           age_months <= 30)
```

```{r models and corrrelations}}
## age and accuracy 
qplot(data=ss_collapsed_acc, x=age_months, y=mean_accuracy) +
    geom_smooth(method="lm")

## model
m.age.acc <- lm(mean_accuracy ~ age_months, data=ss_collapsed_acc)
summary(m.age.acc)

## correlation
cor.test(ss_collapsed_acc$mean_accuracy, ss_collapsed_acc $age_months , method = "pearson")

## age and vocab
qplot(data=ss_collapsed_cdi, x=age_months, y=signs_produced) +
    geom_smooth(method="lm")
# model
m.age.voc <- lm(signs_produced ~ age_months, data=ss_collapsed_cdi)
summary(m.age.voc)
cor.test(ss_collapsed_cdi$signs_produced, ss_collapsed_cdi$age_months , method = "pearson")

## acc and vocab
qplot(data=ss_collapsed_cdi, x=signs_produced, y=mean_accuracy) +
    geom_smooth(method="lm")

m.acc.voc <- lm(mean_accuracy ~ signs_produced, data=ss_collapsed_cdi)
summary(m.acc.voc)

cor.test(ss_collapsed_cdi$signs_produced, 
         ss_collapsed_cdi$mean_accuracy, 
         method = "pearson")

## rt to age
qplot(data=ss_collapsed_acc, x=age_months, y=mean_ct_rt) +
    geom_smooth(method="lm")

cor.test(ss_collapsed_acc$age_months, 
         ss_collapsed_acc$mean_ct_rt, 
         method = "pearson")

## rt to voc
qplot(data=ss_collapsed_cdi, x=signs_produced, y=mean_ct_rt) +
    geom_smooth(method="lm")

# correlation
cor.test(ss_collapsed_cdi$signs_produced, 
         ss_collapsed_cdi$mean_ct_rt, 
         method = "pearson")
```

Make clean scatter plots for SRCD talk:

```{r SRCD scatter plots}
# Acc and CDI, R(19) = 0.44
acc.cdi.scatter <- qplot(data=ss_collapsed_cdi, x=signs_produced, y=mean_accuracy) +
    geom_smooth(method="lm") + 
    xlab("Signs Produced") + 
    xlim(15,80) +
    ylim(0.5,0.8) +
    ylab("Mean \n Accuracy") +
    theme(axis.title.x = element_text(colour="black",size=20,angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.title.y = element_text(colour="black",size=20,angle=0,hjust=0.5,vjust=0.5,face="plain"),
        axis.text.x = element_text(colour="grey20",size=16,angle=0,hjust=0.5,vjust=0,face="plain"),
        axis.text.y = element_text(colour="grey20",size=16,angle=0,hjust=0.5,vjust=0,face="plain"),
        legend.position=c(0.85,0.85),
        legend.text = element_text(size=17),
        legend.title = element_text(size=17, face="bold"))

ggsave("sol.acc.cdi.scatter.pdf", acc.cdi.scatter, width=6, height=5)

# RT and CDI, R(19) = -0.49
rt.cdi.scatter <- qplot(data=ss_collapsed_cdi, x=signs_produced, y=mean_ct_rt) +
    geom_smooth(method="lm") +
    xlab("Signs Produced") + 
    ylim(700, 1800) +
    xlim(15,80) +
    ylab("Mean\nRT") +
    theme(axis.title.x = element_text(colour="black",size=20,angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.title.y = element_text(colour="black",size=20,angle=0,hjust=0.5,vjust=0.5,face="plain"),
        axis.text.x = element_text(colour="grey20",size=16,angle=0,hjust=0.5,vjust=0,face="plain"),
        axis.text.y = element_text(colour="grey20",size=16,angle=0,hjust=0.5,vjust=0,face="plain"),
        legend.position=c(0.85,0.85),
        legend.text = element_text(size=17),
        legend.title = element_text(size=17, face="bold"))

ggsave("sol.rt.cdi.scatter.pdf", rt.cdi.scatter, width=6, height=5)
```


### Analyze first shift accuracy relations

First we need to merge with other summary data for each participant

```{r first shift acc analysis}
# get C-T proportion for each participant
prop_correct_shift <- ss_ct_cd_all_shifts %>%
    filter(trial_type == "C-T") %>%
    select(Sub.Num, trial_type, prop_shift)

prop_correct_shift <- filter(prop_correct_shift, Sub.Num %in% ss_collapsed_acc$Sub.Num)

# sort
ss_collapsed_acc <- arrange(ss_collapsed_acc, Sub.Num)

# merge with other subject level info
ss_collapsed_acc <- merge(ss_collapsed_acc, prop_correct_shift, by="Sub.Num")
```

Now we plot the relationships between first shift accuracy and age

```{r first shift acc and age}
first_shift_age_scatter <- qplot(data=ss_collapsed_acc, x=age_months, y=prop_shift) +
    geom_smooth(method = "lm") + 
    xlab("Age Months") + 
    xlim(15,36) +
    ylim(0.5,0.95) +
    ylab("First Shift\nAccuracy") +
    theme(axis.title.x = element_text(colour="black",size=20,angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.title.y = element_text(colour="black",size=20,angle=0,hjust=0.5,vjust=0.5,face="plain"),
        axis.text.x = element_text(colour="grey20",size=16,angle=0,hjust=0.5,vjust=0,face="plain"),
        axis.text.y = element_text(colour="grey20",size=16,angle=0,hjust=0.5,vjust=0,face="plain"),
        legend.position=c(0.85,0.85),
        legend.text = element_text(size=17),
        legend.title = element_text(size=17, face="bold"))

ggsave("sol.first.shift.age.scatter.pdf", first_shift_age_scatter, width=6, height=5)

# correlation
cor.test(ss_collapsed_acc$age_months, 
         ss_collapsed_acc$prop_shift, 
         method = "pearson")
```

First shift acc and rt

```{r first shift acc and age}
qplot(data=ss_collapsed_acc, x=prop_shift, y=mean_ct_rt) +
    geom_smooth(method = "lm") 

# correlation
cor.test(ss_collapsed_acc$mean_ct_rt, 
         ss_collapsed_acc$prop_shift, 
         method = "pearson")
```

First shift acc and mean acc

```{r first shift acc and mean acc}
qplot(data=ss_collapsed_acc, x=prop_shift, y=mean_accuracy) +
    geom_smooth(method = "lm")

# correlation
cor.test(ss_collapsed_acc$mean_accuracy, 
         ss_collapsed_acc$prop_shift, 
         method = "pearson")

```

First shift acc and cdi

```{r first shift acc and age}
ss_collapsed_cdi_fs <- filter(ss_collapsed_acc, 
                           include==1, 
                           Age_Bin != "NA", 
                           Age_Bin != "Adults",
                           age_months <= 30)

qplot(data=ss_collapsed_cdi_fs, x=signs_produced, y=prop_shift) +
    geom_smooth(method = "lm")

# correlation
cor.test(ss_collapsed_cdi_fs$signs_produced, 
         ss_collapsed_cdi_fs$prop_shift, 
         method = "pearson")
```


### Trio comparison

Get mean C-T RT for each age group

```{r TRIO comparsion RT by age group}
# get comparable age group (Trio = 24-26 months)
ss_trio_comparsion <- filter(ss_collapsed_acc, age_months >= 24, age_months <= 36)

ms_trio <- ss_trio_comparsion %>%
      summarise(mean_rt = mean(mean_ct_rt),
                ci.high.rt = ci.high(mean_ct_rt),
                ci.low.rt = ci.low(mean_ct_rt)) %>%
    mutate(Experiment = "ASL")

ms_sol_mean_ct <- filter(ms_ct_cd_filt_collapsed, trial_type == "Center-Target", age_group == "> 24 Months")

ms_trio <- cbind(ms_trio, ms_sol_mean_ct)

# merge with mean RTs from Trio-Face and Trio-Bull
ms_trio_face_bull <- read.csv("/Users/kmacdonald/Documents/Projects/SOL/SOL-Data/SOL-raw-data/ms-trio-comp.csv", sep = ",")
ms_trio_final <- rbind(ms_trio, ms_trio_face_bull)


# reorder factor levels for plotting
ms_trio_final$Experiment <- factor(ms_trio_final$Experiment, 
                              levels = c("Trio-Bull", "Trio-Face", "ASL"))

# plot with proportion of C-T, C-D shifts
trio.comparison.plot <- qplot(data=ms_trio_final, x=Experiment, y=mean_prop, geom="bar",
                              stat="identity", position = "dodge", ylim=c(0,1),
                              xlab=c("Experiment"),
                              ylab=c("Proportion \n of trials")) +
    geom_linerange(limits, width=0.1, position=position_dodge(.9)) +
    geom_hline(yintercept=0.5, linetype = "dashed") +
    theme(axis.title.x = element_text(colour="black",size=16,angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.title.y = element_text(colour="black",size=16,angle=0,hjust=0.5,vjust=0.5,face="plain"),
          axis.text.x = element_text(colour="grey20",size=12,angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.text.y = element_text(colour="grey20",size=12,angle=0,hjust=0.5,vjust=0,face="plain"),
          legend.position=c(0.85,0.85),
          legend.text = element_text(size=13),
          legend.title = element_text(size=13, face="bold"))

ggsave("sol-trio-comp-srcd",trio.comparison.plot, width=7, height=3.5)

## rt plot
limits.rt <- aes(ymax = mean_rt + ci.high.rt, ymin= mean_rt - ci.low.rt)


trio_rt_plot <- qplot(data=ms_trio_final, x=Experiment, y=mean_rt, geom="bar",
                              stat="identity", position = "dodge", ylim=c(0,1250),
                              xlab=c("Experiment"),
                              ylab=c("Mean \n Reaction Time")) +
    geom_linerange(limits.rt, width=0.1, position=position_dodge(.9)) +
    theme(axis.title.x = element_text(colour="black",size=16,angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.title.y = element_text(colour="black",size=16,angle=0,hjust=0.5,vjust=0.5,face="plain"),
          axis.text.x = element_text(colour="grey20",size=12,angle=0,hjust=0.5,vjust=0,face="plain"),
          axis.text.y = element_text(colour="grey20",size=12,angle=0,hjust=0.5,vjust=0,face="plain"),
          legend.text = element_text(size=13),
          legend.title = element_text(size=13, face="bold"))

ggsave("sol-trio-rt-srcd",trio_rt_plot, width=7, height=3.5)
```




#### Compare Van1 vs. Van2 for trials removed because of inattentiveness 

```{r prescreening comparison}
ps_v1 <- iChart_1 %>%
            group_by(Prescreen.Notes) %>%
            summarise(count = n()) %>%
            mutate(proportion = count / sum(count), 
                   experiment = "Vanilla.1", 
                   Prescreen.Notes = as.factor(Prescreen.Notes))

ps_v2 <- iChart_2 %>%
            group_by(Prescreen.Notes) %>%
            summarise(count = n()) %>%
            mutate(proportion = count / sum(count),
                   experiment = "Vanilla.2",
                   Prescreen.Notes = as.factor(Prescreen.Notes))

# merge
ps_all <- rbind(ps_v1, ps_v2)

# revalue blank factor level (trials not prescreened out) with a more meaningful code 
levels(ps_all$Prescreen.Notes)[1] <- "Good"

# now grab just the child-driven codes from each experiment
ps_child_driven <- filter(ps_all, Prescreen.Notes == "Child Talking" |
                                Prescreen.Notes == "Inattentive" |
                                Prescreen.Notes == "Not Looking Before Critical Word" |
                                Prescreen.Notes == "Fidgeting, Fussy")

# now collapse 
ps_child_collapsed <- ps_child_driven %>%
                        group_by(experiment) %>%
                        summarise(total_count = sum(count),
                                  total_proportion = sum(proportion))
# now plot
qplot(data=ps_child_collapsed, x=experiment, y=total_proportion, 
      geom="bar", stat="identity", fill=experiment, ylim = c(0, 0.35),
      ylab=c("Proportion trials removed \n with child-driven codes"),
      xlab=c("Experiment"))
```


#### ANALYSIS ####

### Relationship between Acc and Age/Vocab (Kids)

Merge the accuracy data with demographic data and filter to get good subs. We filter out 

- adults 
- kids who were reported to not know the signs on the peek, 
- and kids younger than 15 months and older than 42 months.

```{r merge peek and demo data}
ms_sol <- join(sol_demo_df, accuracy, by = "Sub.Num")
ms_sol <- join(ms_sol, RT, by = "Sub.Num")
ms_sol_filt <- filter(.data = ms_sol, include == 1, age_months >= 15, age_months <= 42)
```

Vizualize distributions of age and cdi scores

```{r vizualize distributions age/vocab/cdi, warning=F, message=FALSE}
age_dist <- ggplot(ms_sol_filt, aes(age_months)) + 
                  geom_histogram(aes(y=..density..),fill=NA, color="black") +
                  geom_density(alpha=.2, fill="#FF6666")

cdi_dist <- ggplot(ms_sol_filt, aes(signs_produced)) + 
                  geom_histogram(aes(y=..density..),fill=NA, color="black") +
                  geom_density(alpha=.2, fill="#FF6666")

multiplot(age_dist, cdi_dist, cols = 2)
```

To get correlations between Accuracy, Age, and Vocabulary we use both Pearson and Spearman because the cdi scores are skewed. We then can compare the output of the two.

Text below is taken from: http://rpubs.com/dgolicher/2286

The Spearman procedure is very robust as it is based on ranks. It will answer the fundamental question. Is there a relationship of some form between the two variables? Does an increase in x lead to an increase in y? 

From: A guide to appropriate use of Correlation coefficient in medical research, MM Mukaka

Spearman's rank correlation coefficient is denoted as [var rho]s for a population parameter and as rs for a sample statistic. It is appropriate when one or both variables are skewed or ordinal and is robust when extreme values are present.

```{r acc/age correlations, warning=FALSE}
# correlation between age and accuracy on peek
cor.test(ms_sol_filt$vanilla, ms_sol_filt$age_months, method = "spearman")
cor.test(ms_sol_filt$vanilla, ms_sol_filt$age_months, method = "pearson")
# correlation between accuracy on the peek and vocab
cor.test(ms_sol_filt$vanilla, ms_sol_filt$signs_produced, method = "spearman")
cor.test(ms_sol_filt$vanilla, ms_sol_filt$signs_produced, method = "pearson")
```

The Pearson vs. Spearman correlations for age and accuracy are not very different. However, the cdi and accuracy is, probably because of the skewed distribution of cdi scores. 

Next we try to transform the cdi scores. 

### CDI score transformations

Taken from: http://fmwww.bc.edu/repec/bocode/t/transint.html

Reducing skewness A transformation may be used to reduce skewness. 
A distribution that is symmetric or nearly so is often easier to handle and
interpret than a skewed distribution. More specifically, a normal or
Gaussian distribution is often regarded as ideal as it is assumed by many
statistical methods.

- To reduce right skewness, take roots or logarithms or reciprocals (roots
are weakest). This is the commonest problem in practice.

- To reduce left skewness, take squares or cubes or higher powers.

```{r transformations of cdi scores, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}
ms_sol_filt <- ms_sol_filt %>%
      mutate(signs_produced_log_e = log(signs_produced),
             signs_produced_log_10 = log10(signs_produced),
             signs_produced_sqrt = sqrt(signs_produced),
             signs_produced_squares = signs_produced^2,
             signs_produced_cubes = signs_produced^3,
             signs_produced_reciprocal = 1/signs_produced)
```

```{r acc/age correlations transformed vars, warning=FALSE}
# correlation between accuracy on the peek and vocab cube transformed
cor.test(ms_sol_filt$vanilla, ms_sol_filt$signs_produced_squares, method = "spearman")
cor.test(ms_sol_filt$vanilla, ms_sol_filt$signs_produced_squares, method = "pearson")

# correlation between accuracy on the peek and vocab cube transformed
cor.test(ms_sol_filt$vanilla, ms_sol_filt$signs_produced_cubes, method = "spearman")
cor.test(ms_sol_filt$vanilla, ms_sol_filt$signs_produced_cubes, method = "pearson")
```

#### Test for normality of cdi scores

The null-hypothesis of this test is that the population is normally distributed. Thus if the p-value is less than the chosen alpha level, then the null hypothesis is rejected and there is evidence that the data tested are not from a normally distributed population.


```{r test normality full data set}
cdi_transformed <- ms_sol_filt %>% select(signs_produced, signs_produced_log_e,
                                          signs_produced_log_10, signs_produced_sqrt,
                                          signs_produced_squares, signs_produced_cubes,
                                          signs_produced_reciprocal)
lapply(cdi_transformed, shapiro.test)
```

All variables show evidence they are not from a normally distribution.

#### Vizualize Distribution of transformed variables

```{r vizualize transformed variables}
cdi_log_e <- ggplot(ms_sol_filt, aes(signs_produced_log_e)) + 
                  geom_histogram(aes(y=..density..),fill=NA, color="black") +
                  geom_density(alpha=.2, fill="#FF6666")

cdi_log_10 <- ggplot(ms_sol_filt, aes(signs_produced_log_10)) + 
                  geom_histogram(aes(y=..density..),fill=NA, color="black") +
                  geom_density(alpha=.2, fill="#FF6666")

cdi_sqrt <- ggplot(ms_sol_filt, aes(signs_produced_sqrt)) + 
                  geom_histogram(aes(y=..density..),fill=NA, color="black") +
                  geom_density(alpha=.2, fill="#FF6666")

cdi_squares <- ggplot(ms_sol_filt, aes(signs_produced_squares)) + 
                  geom_histogram(aes(y=..density..),fill=NA, color="black") +
                  geom_density(alpha=.2, fill="#FF6666")

cdi_cubes <- ggplot(ms_sol_filt, aes(signs_produced_cubes)) + 
                  geom_histogram(aes(y=..density..),fill=NA, color="black") +
                  geom_density(alpha=.2, fill="#FF6666")

cdi_recip <- ggplot(ms_sol_filt, aes(signs_produced_reciprocal)) + 
                  geom_histogram(aes(y=..density..),fill=NA, color="black") +
                  geom_density(alpha=.2, fill="#FF6666")


multiplot(cdi_dist, cdi_log_e, cdi_log_10, cdi_sqrt, cdi_squares, cdi_cubes, cols = 3)
```

### Scatter Plots: Accuracy with all Kids

```{r scatter full dataset, fig.width=12, warning=FALSE}
age_acc_plot <- ggplot(data=ms_sol_filt, aes(x=age_months, y=vanilla)) +
                        geom_point(size=4) + 
                        xlab("Age (months)") +
                        ylab("Mean Accuracy") +
                        ylim(0.44, 0.75) +
                        theme(axis.title.x=element_text(vjust=-0.5)) +
                        theme(axis.title.y=element_text(vjust=0.1)) +
                        stat_smooth(method="lm", se=FALSE) +
                        ggtitle("Positive Relationship Between Age and Accuracy") +
                        geom_text(x=35, y=0.5, label="r(24) = .45", size = 8, face="bold")

cdi_acc_plot <- ggplot(data=ms_sol_filt, aes(x=signs_produced, y=vanilla)) +
                        geom_point(size=4) + 
                        xlab("Signs Produced") +
                        ylab("Mean Accuracy") +
                        ylim(0.42, 0.75) +
                        theme(axis.title.x=element_text(vjust=-0.5)) +
                        theme(axis.title.y=element_text(vjust=0.3)) +
                        stat_smooth(method="lm", se=FALSE) +
                        ggtitle("Positive Relationship Between Vocabulary and Accuracy") +
                        geom_text(x=65, y=0.5, label="r(21) = .41", size = 8, face="bold")

multiplot(age_acc_plot, cdi_acc_plot, cols = 2)
```

### Accuracy with just kids between 15-30 months

Another way to deal with the ceiling effects of the CDI is to limit the analysis to just those subjects between the ages fo 15-30 months, the ages that the PEEK and CDI were designed to test and have provided the most reliable data in prior studies.

```{r filter 15-30 months}
ms_sol_filt_15_30 <- filter(ms_sol, include == 1, age_months >= 15, age_months <= 30)
```

Vizualize Distributions

```{r vizualize distributions 15-30 months, warning=F, message=FALSE}
age_dist_15_30 <- ggplot(ms_sol_filt_15_30, aes(age_months)) + 
                        geom_histogram(aes(y=..density..),fill=NA, color="black") +
                        geom_density(alpha=.2, fill="#FF6666")

cdi_dist_15_30 <- ggplot(ms_sol_filt_15_30, aes(signs_produced)) + 
                        geom_histogram(aes(y=..density..),fill=NA, color="black") +
                        geom_density(alpha=.2, fill="#FF6666")

multiplot(age_dist_15_30, cdi_dist_15_30, cols = 2)
```

Correlations

```{r correlations 15-30 months, warning=FALSE}
# age to acc
cor.test(ms_sol_filt_15_30$vanilla, ms_sol_filt_15_30$age_months, method = "pearson")
cor.test(ms_sol_filt_15_30$vanilla, ms_sol_filt_15_30$age_months, method = "spearman")
# cdi to acc
cor.test(ms_sol_filt_15_30$vanilla, ms_sol_filt_15_30$signs_produced, method = "pearson")
cor.test(ms_sol_filt_15_30$vanilla, ms_sol_filt_15_30$signs_produced, method = "spearman")
```

Scatter plots

```{r scatter 15-30 months, warning=FALSE, fig.width=12}
age_acc_plot_15_30 <- ggplot(data=ms_sol_filt_15_30, aes(x=age_months, y=vanilla)) +
                        geom_point(size=4) + 
                        xlab("Age (months)") +
                        ylab("Mean Accuracy") +
                        ylim(0.44, 0.75) +
                        theme(axis.title.x=element_text(vjust=-0.5)) +
                        theme(axis.title.y=element_text(vjust=0.1)) +
                        stat_smooth(method="lm", se=FALSE) +
                        ggtitle("Positive Relationship Between Age and Accuracy") +
                        geom_text(x=25, y=0.5, label="r(14) = .60", size = 8, face="bold")

cdi_acc_plot_15_30 <- ggplot(data=ms_sol_filt_15_30, aes(x=signs_produced, y=vanilla)) +
                        geom_point(size=4) + 
                        xlab("Signs Produced") +
                        ylab("Mean Accuracy") +
                        ylim(0.42, 0.75) +
                        theme(axis.title.x=element_text(vjust=-0.5)) +
                        theme(axis.title.y=element_text(vjust=0.3)) +
                        stat_smooth(method="lm", se=FALSE) +
                        ggtitle("Positive Relationship Between Vocabulary and Accuracy") +
                        geom_text(x=65, y=0.5, label="r(11) = .61", size = 8, face="bold")
```

##### Compare the filtered (15-30 months) scatter to the scatter of the whole dataset (15-42 months).

```{r scatter filtered vs. not filtered, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}
multiplot(age_acc_plot, age_acc_plot_15_30, cdi_acc_plot, cdi_acc_plot_15_30, cols = 2)
```

## Profile plot for kid and adult data

```{r compute accuracy: kid and adult data, warning=FALSE}
## convert Months to numeric
iChart$Months <- as.numeric(iChart$Months)

## filter subjects: only keep kids under 30 months and adults
iChart_filt <- subset(iChart, (Months >= 15 & Months <= 30) | Months > 100)

## remove prescreened out trials
iChart_filt <- iChart_filt[iChart_filt$Prescreen.Notes == "",]

## define onset, changing Cs to Ds and everything else as As
iChart_filt <- defineOnsetSOL(iChart_filt, critonset=0, includeOffCenter=FALSE)

# compute gaps
iChart_filt <- computeStatistics(iChart_filt, startWindow=0, endWindow=4000)

# filter iChart: reject trials with extreme RT and gaps
iChart_filt <- filteriChart(iChart_filt, minRT=300, maxRT=3500, maxfirstgap=15, maxlonggap=15)

## split sample into three groups based on age: young (< 24months, > 24months, adults)
iChart_filt$Condition <- ifelse(iChart_filt$Months < 24, "< 24 Months", 
                  ifelse(iChart_filt$Months >= 24 & iChart_filt$Months <= 30, "> 24 Months",
                  ifelse(iChart_filt$Months > 100, "Adults", NA)))

## compute accuracy for each age group
accuracy.by.cond.filt <- poolData(meanAccuracy(iChart_filt, startWindowAcc=300, endWindowAcc=1800), 
                                  RejectFirstGap=TRUE, RejectLongestGap=TRUE, RejectRT=FALSE, 
                                  color=TRUE, dependent="Accuracy", group="", 
                                  facet="Condition", dodge="", xlab="", 
                                  ylab= "Proportion\n  Looking\n  to target", paired=TRUE, 
                                  miny = 0.2, maxy = 0.80, size=13, legend.direction="horizontal", 
                                  legend.position="bottom", breaks=c(0.25, 0.50, 0.75))

createPlots(iChart_filt, startWindow=0, endWindow=2000, RejectLongestGap=FALSE, 
            RejectFirstGap=FALSE, RejectRT=FALSE, color=TRUE, smooth=400, 
            targetEnd=800, carrier="", targets=c(""), 
            group="",  plotStats="PP", miny = 0.4, maxy=0.95, size=15, 
            legend.direction = "vertical", legend.position=c(0.85, 0.9), 
            breaks=c(0.25, 0.50, 0.75), x.target=0.33)
```

### Relationship between RT and Age/Vocab (All Kids)

```{r relationship between RT and age/vocab}
ms_sol_filt_rt <- filter(.data = ms_sol, include == 1, age_months >= 15, age_months <= 30)

# correlation between age and accuracy on peek
cor.test(ms_sol_filt_rt$vanilla_D, ms_sol_filt_rt$age_months)
# correlation between accuracy on the peek and vocab
cor.test(ms_sol_filt_rt$vanilla_D, ms_sol_filt_rt$signs_produced)
```

## RT Scatter Plots

```{r RT scatter plots, fig.width=12, warning=FALSE}
age_rt_plot <- ggplot(data=ms_sol_filt_rt, aes(x=age_months, y=vanilla_D)) +
                        geom_point(size=4) + 
                        xlab("Age (months)") +
                        ylab("Reaction Time") +
                        theme(axis.title.x=element_text(vjust=-0.5)) +
                        theme(axis.title.y=element_text(vjust=0.1)) +
                        stat_smooth(method="lm", se=FALSE) +
                        ggtitle("Negative Relationship Between Age and RT") +
                        geom_text(x=35, y=0.5, label="r(24) = .48", size = 8, face="bold")


# plot
cdi_rt_plot <- ggplot(data=ms_sol_filt_rt, aes(x=signs_produced, y=vanilla_D)) +
                        geom_point(size=4) + 
                        xlab("Signs Produced") +
                        ylab("Reaction Time") +
                        theme(axis.title.x=element_text(vjust=-0.5)) +
                        theme(axis.title.y=element_text(vjust=0.3)) +
                        stat_smooth(method="lm", se=FALSE) +
                        ggtitle("Negative Relationship Between Vocabulary and RT") +
                        geom_text(x=65, y=0.5, label="r(21) = .44", size = 8, face="bold")

multiplot(age_rt_plot, cdi_rt_plot, cols = 2)
```

### Relationship between Vocab and Peek, controlling for age

#### Get correlation matrix 

```{r correlation matrix}
ms_sol_corrs <- select(ms_sol_filt, age_months, signs_produced, vanilla, vanilla_D) 
r_sol <- cor(ms_sol_corrs, use = "pairwise.complete.obs")
r_sol
```

#### Now compute partial correlations

```{r partial correlations}
pr.mar = partial.r(ms_sol_corrs, c(2:3), 1)
pr.mar
```

#### Multiple regression predicting accuracy (DV) with age and CDI as IVs

The goal here is to see whether all of the variance is overlapping or whether one of the predictors adds variance over the other.

Model 1: DV: accuracy, step 1: IV age, step 2: IV CDI.  

```{r model 1}
m1_step1 <- lm(vanilla ~ age_months,
         data = ms_sol_filt)

m1_step2 <- lm(vanilla ~ age_months + signs_produced,
         data = ms_sol_filt)
summary(m1_step2)
```

What is the r-squared change between step 1 and 2?

```{r r-squared model 1}
summary(m1_step1)$r.squared
summary(m1_step2)$r.squared 
```

Model 2: DV: accuracy: step 2: IV CDI, step 2: IV age. 

```{r model 2}
m2_step1 <- lm(vanilla ~ signs_produced,
         data = ms_sol_filt)

m2_step2 <- lm(vanilla ~ signs_produced + age_months,
         data = ms_sol_filt)
summary(m2_step2)
```

What is the r-squared change between step 1 and 2?

```{r r-squared model 2}
summary(m2_step1)$r.squared
summary(m2_step2)$r.squared 
```

Compare full models (including age and vocab as predictors)

```{r compare full models}
anova(m1_step2, m2_step2)
```

#### Multiple regression predicting accuracy (DV) with age and CDI as IVs (just kids between 15-30 months)

Model 1: DV: accuracy, step 1: IV age, step 2: IV CDI.  

```{r model 1 15-30 months}
m1_step1_15_30 <- lm(vanilla ~ age_months,
         data = ms_sol_filt_15_30)
summary(m1_step1_15_30)

m1_step2_15_30 <- lm(vanilla ~ age_months + signs_produced,
         data = ms_sol_filt_15_30)
summary(m1_step2_15_30)
```

What is the r-squared change between step 1 and 2?

```{r r-squared model 1 15-30 months}
summary(m1_step1_15_30)$r.squared
summary(m1_step2_15_30)$r.squared 
```

Model 2: DV: accuracy: step 2: IV CDI, step 2: IV age. 

```{r model 2 15-30 months}
m2_step1_15_30 <- lm(vanilla ~ signs_produced,
         data = ms_sol_filt_15_30)
summary(m2_step1_15_30)

m2_step2_15_30 <- lm(vanilla ~ signs_produced + age_months,
         data = ms_sol_filt_15_30)
summary(m2_step2_15_30)
```

What is the r-squared change between step 1 and 2?

```{r r-squared model 2 15-30 months}
summary(m2_step1)$r.squared
summary(m2_step2)$r.squared 
```

Compare full models (including age and vocab as predictors)

```{r compare full models 15-30 months}
anova(m1_step2, m2_step2)
```